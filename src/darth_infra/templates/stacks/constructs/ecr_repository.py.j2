"""ECR repository construct â€” one per service, shared across environments."""

from aws_cdk import RemovalPolicy, aws_ecr
from constructs import Construct


class EcrRepository(Construct):
    """Creates an ECR repository for a single service.

    Repository naming: ``{project_name}/{service_name}``
    """

    def __init__(
        self,
        scope: Construct,
        construct_id: str,
        *,
        project_name: str,
        service_name: str,
    ) -> None:
        super().__init__(scope, construct_id)

        self.repository = aws_ecr.Repository(
            self,
            "Repo",
            repository_name=f"{project_name}/{service_name}",
            removal_policy=RemovalPolicy.RETAIN,
            lifecycle_rules=[
                aws_ecr.LifecycleRule(
                    description="Keep last 10 images",
                    max_image_count=10,
                    rule_priority=1,
                ),
            ],
        )
